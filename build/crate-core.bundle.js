require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function GUID(){var d=(new Date).getTime();var guid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c==="x"?r:r&3|8).toString(16)});return guid}module.exports=GUID},{}],2:[function(require,module,exports){function MInsertOperation(insert){this.type="MInsertOperation";this.insert=insert}module.exports.MInsertOperation=MInsertOperation;function MAEInsertOperation(insert,id){this.type="MAEInsertOperation";this.payload=new MInsertOperation(insert);this.id=id;this.isReady=null}module.exports.MAEInsertOperation=MAEInsertOperation;function MRemoveOperation(remove){this.type="MRemoveOperation";this.remove=remove}module.exports.MRemoveOperation=MRemoveOperation;function MCaretMovedOperation(caretMoved){this.type="MCaretMovedOperation";this.caretMoved=caretMoved}module.exports.MCaretMovedOperation=MCaretMovedOperation},{}],3:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var util=require("util");var GUID=require("./guid.js");var MBroadcast=require("./messages").MBroadcast;var MAntiEntropyRequest=require("./messages.js").MAntiEntropyRequest;var MAntiEntropyResponse=require("./messages.js").MAntiEntropyResponse;var Unicast=require("unicast-definition");util.inherits(CausalBroadcast,EventEmitter);function CausalBroadcast(source,causality,name){EventEmitter.call(this);this.name=name||"causal";this.source=source;this.causality=causality;this.deltaAntiEntropy=1e3*60*1/2;this.unicast=new Unicast(this.source,this.name+"-unicast");this.buffer=[];this.bufferAntiEntropy=new MAntiEntropyResponse("init");var self=this;this.source.on(self.name+"-broadcast-receive",function(socket,message){self.receiveBroadcast(message)});this.unicast.on("receive",function(socket,message){self.receiveUnicast(socket,message)});this.source.on("statechange",function(state){if(state==="connect"){self.unicast.send(new MAntiEntropyRequest(self.causality))}});setInterval(function(){self.unicast.send(new MAntiEntropyRequest(self.causality))},self.deltaAntiEntropy)}CausalBroadcast.prototype.send=function(message,id,isReady){var links=this.source.getPeers(Number.MAX_VALUE);var mBroadcast=new MBroadcast(this.name,id||GUID(),isReady,message);this.causality.incrementFrom(id);for(var i=0;i<links.length;++i){if(links[i].connected&&links[i]._channel&&links[i]._channel.readyState==="open"){links[i].send(mBroadcast)}}};CausalBroadcast.prototype.sendAntiEntropyResponse=function(socket,causalityAtReceipt,messages){var id=GUID();this.unicast.send(new MAntiEntropyResponse(id,causalityAtReceipt,messages.length),socket);for(var i=0;i<messages.length;++i){this.unicast.send(new MAntiEntropyResponse(id,null,messages.length,messages[i]),socket)}};CausalBroadcast.prototype.receiveBroadcast=function(message){var id=message.id,isReady=message.isReady;if(!this.stopPropagation(message)){this.buffer.push(message);this.reviewBuffer();var links=this.source.getPeers(Number.MAX_VALUE);for(var i=0;i<links.length;++i){if(links[i].connected&&links[i]._channel&&links[i]._channel.readyState==="open"){links[i].send(message)}}}};CausalBroadcast.prototype.reviewBuffer=function(){var found=false,i=this.buffer.length-1;while(i>=0){var message=this.buffer[i];if(this.causality.isLower(message.id)){this.buffer.splice(i,1)}else{if(this.causality.isReady(message.isReady)){found=true;this.causality.incrementFrom(message.id);this.buffer.splice(i,1);this.emit("receive",message.payload)}}--i}if(found){this.reviewBuffer()}};CausalBroadcast.prototype.receiveUnicast=function(socket,message){switch(message.type){case"MAntiEntropyRequest":this.emit("antiEntropy",socket,message.causality,this.causality.clone());break;case"MAntiEntropyResponse":if(this.bufferAntiEntropy.id!==message.id){this.bufferAntiEntropy=message};if(message.element){this.bufferAntiEntropy.elements.push(message.element)};if(message.causality){this.bufferAntiEntropy.causality=message.causality};if(this.bufferAntiEntropy.elements.length===this.bufferAntiEntropy.nbElements){for(var i=0;i<this.bufferAntiEntropy.elements.length;++i){var element=this.bufferAntiEntropy.elements[i];if(!this.stopPropagation(element)){this.causality.incrementFrom(element.id);this.emit("receive",element.payload)}}this.causality.merge(this.bufferAntiEntropy.causality)};break}};CausalBroadcast.prototype.stopPropagation=function(message){return this.causality.isLower(message.id)||this.bufferIndexOf(message.id)>=0};CausalBroadcast.prototype.bufferIndexOf=function(id){var found=false,index=-1,i=0;while(!found&&i<this.buffer.length){if(JSON.stringify(this.buffer[i].id)===JSON.stringify(id)){found=true;index=i}++i}return index};module.exports=CausalBroadcast},{"./guid.js":4,"./messages":5,"./messages.js":5,events:43,"unicast-definition":7,util:64}],4:[function(require,module,exports){arguments[4][1][0].apply(exports,arguments)},{dup:1}],5:[function(require,module,exports){function MBroadcast(name,id,isReady,payload){this.protocol=name&&name+"-broadcast"||"causal-broadcast";this.id=id;this.isReady=isReady;this.payload=payload}module.exports.MBroadcast=MBroadcast;function MAntiEntropyRequest(causality){this.type="MAntiEntropyRequest";this.causality=causality}module.exports.MAntiEntropyRequest=MAntiEntropyRequest;function MAntiEntropyResponse(id,causality,nbElements,element){this.type="MAntiEntropyResponse";this.id=id;this.causality=causality;this.nbElements=nbElements;this.element=element;this.elements=[]}module.exports.MAntiEntropyResponse=MAntiEntropyResponse},{}],6:[function(require,module,exports){function MUnicast(name,payload){this.protocol=name||"unicast";this.payload=payload}module.exports.MUnicast=MUnicast},{}],7:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var util=require("util");var MUnicast=require("./messages").MUnicast;util.inherits(Unicast,EventEmitter);function Unicast(source,max,name){EventEmitter.call(this);this.name=name||"unicast";this.source=source;var self=this;this.source.on(self.name+"-receive",function(socket,message){self.emit("receive",socket,message.payload)})}Unicast.prototype.send=function(message,socket){var links=socket&&[socket]||this.source.getPeers(1);var mUnicast=new MUnicast(this.name,message);if(links.length>0&&links[0].connected){links[0].send(mUnicast)}};module.exports=Unicast},{"./messages":6,events:43,util:64}],8:[function(require,module,exports){var BI=require("BigInt");function Base(b){var DEFAULT_BASE=3;this._b=b||DEFAULT_BASE}Base.prototype.getBitBase=function(level){return this._b+level};Base.prototype.getSumBit=function(level){var n=this.getBitBase(level),m=this._b-1;return n*(n+1)/2-m*(m+1)/2};Base.prototype.getInterval=function(p,q,level){var sum=0,i=0,pIsGreater=false,commonRoot=true,prevValue=0,nextValue=0;while(i<=level){prevValue=0;if(p!==null){prevValue=p.t.p}nextValue=0;if(q!==null){nextValue=q.t.p}if(commonRoot&&prevValue!==nextValue){commonRoot=false;pIsGreater=prevValue>nextValue}if(pIsGreater){nextValue=Math.pow(2,this.getBitBase(i))-1}if(commonRoot||pIsGreater||i!==level){sum+=nextValue-prevValue}else{sum+=nextValue-prevValue-1}if(i!==level){sum*=Math.pow(2,this.getBitBase(i+1))}if(p!==null&&p.children.length!==0){p=p.children[0]}else{p=null}if(q!==null&&q.children.length!==0){q=q.children[0]}else{q=null}++i}return sum};Base.instance=null;module.exports=function(args){if(args){Base.instance=new Base(args)}else{if(Base.instance===null){Base.instance=new Base}}return Base.instance}},{BigInt:15}],9:[function(require,module,exports){var BI=require("BigInt");var Base=require("./base.js")();var Triple=require("./triple.js");var LSEQNode=require("./lseqnode.js");function Identifier(d,s,c){this._d=d;this._s=s;this._c=c}Identifier.prototype.fromNode=function(node){var length=1,tempNode=node,i=0;while(tempNode.children.length!==0){++length;tempNode=tempNode.children[0]}this._d=BI.int2bigInt(0,Base.getSumBit(length-1));for(var i=0;i<length;++i){this._s.push(node.t.s);this._c.push(node.t.c);BI.addInt_(this._d,node.t.p);if(i!==length-1){BI.leftShift_(this._d,Base.getBitBase(i+1))}node=node.children[0]}};Identifier.prototype.toNode=function(e){var resultPath=[],dBitLength=Base.getSumBit(this._c.length-1),i=0,mine;for(var i=0;i<this._c.length;++i){mine=BI.dup(this._d);BI.rightShift_(mine,dBitLength-Base.getSumBit(i));resultPath.push(new Triple(BI.modInt(mine,Math.pow(2,Base.getBitBase(i))),this._s[i],this._c[i]))}return new LSEQNode(resultPath,e)};Identifier.prototype.compare=function(o){var dBitLength=Base.getSumBit(this._c.length-1),odBitLength=Base.getSumBit(o._c.length-1),comparing=true,comp=0,i=0,sum,mine,other;while(comparing&&i<Math.min(this._c.length,o._c.length)){sum=Base.getSumBit(i);mine=BI.dup(this._d);BI.rightShift_(mine,dBitLength-sum);other=BI.dup(o._d);BI.rightShift_(other,odBitLength-sum);if(!BI.equals(mine,other)){if(BI.greater(mine,other)){comp=1}else{comp=-1}comparing=false}else{comp=this._s[i]-o._s[i];if(comp!==0){comparing=false}else{comp=this._c[i]-o._c[i];if(comp!==0){comparing=false}}}++i}if(comp===0){comp=this._c.length-o._c.length}return comp};module.exports=Identifier},{"./base.js":8,"./lseqnode.js":10,"./triple.js":13,BigInt:15}],10:[function(require,module,exports){var Triple=require("./triple.js");require("./util.js");function LSEQNode(tripleList,element){this.t=tripleList.shift();if(tripleList.length===0){this.e=element;this.subCounter=0;this.children=[]}else{this.e=null;this.subCounter=1;this.children=[];this.children.push(new LSEQNode(tripleList,element))}}LSEQNode.prototype.add=function(node){var index=this.children.binaryIndexOf(node);if(index<0||this.children.length===0||index===0&&this.children.length>0&&this.children[0].compare(node)!==0){this.children.splice(-index,0,node);this.subCounter+=1}else{if(node.children.length===0){if(this.children[index].e!==null){return-1}else{this.children[index].e=node.e;this.subCounter+=1}}else{if(this.children[index].add(node.children[0])!==-1){this.subCounter+=1}}}};LSEQNode.prototype.del=function(node){var indexes=this.getIndexes(node),currentTree=this,i=0,isSplitted=false;if(indexes===-1){return-1}this.subCounter-=1;while(i<indexes.length&&!isSplitted){if(!(currentTree.children[indexes[i]].e!==null&&i===indexes.length-1)){currentTree.children[indexes[i]].subCounter-=1}if(currentTree.children[indexes[i]].subCounter<=0&&(currentTree.children[indexes[i]].e===null||currentTree.children[indexes[i]].e!==null&&i===indexes.length-1)){currentTree.children.splice(indexes[i],1);isSplitted=true}currentTree=currentTree.children[indexes[i]];++i}if(!isSplitted){currentTree.e=null}};LSEQNode.prototype.compare=function(o){return this.t.compare(o.t)};LSEQNode.prototype.indexOf=function(node){var indexes=this.getIndexes(node),sum=0,currentTree=this,j=0;if(indexes===-1){return-1}if(this.e!==null){sum+=1}for(var i=0;i<indexes.length;++i){if(indexes[i]<currentTree.children.length/2){for(var j=0;j<indexes[i];++j){if(currentTree.children[j].e!==null){sum+=1}sum+=currentTree.children[j].subCounter}}else{sum+=currentTree.subCounter;for(var j=currentTree.children.length-1;j>=indexes[i];--j){if(currentTree.children[j].e!==null){sum-=1}sum-=currentTree.children[j].subCounter}j+=1}if(currentTree.children[j].e!==null){sum+=1}currentTree=currentTree.children[j]}return sum-1};LSEQNode.prototype.getIndexes=function(node){function _getIndexes(indexes,currentTree,currentNode){var index=currentTree.children.binaryIndexOf(currentNode);if(index<0||index===0&&currentTree.children.length===0){return-1}indexes.push(index);if(currentNode.children.length===0||currentTree.children.length===0){return indexes}return _getIndexes(indexes,currentTree.children[index],currentNode.children[0])}return _getIndexes([],this,node)};LSEQNode.prototype.get=function(index){function _get(leftSum,buildingNode,queue,currentNode){var startBeginning=true,useFunction,i=0,p,temp;if(leftSum===index&&currentNode.e!==null){queue.e=currentNode.e;return buildingNode}if(currentNode.e!==null){leftSum+=1}startBeginning=index-leftSum<currentNode.subCounter/2;if(startBeginning){useFunction=function(a,b){return a+b}}else{leftSum+=currentNode.subCounter;useFunction=function(a,b){return a-b}}if(!startBeginning){i=currentNode.children.length-1}while(startBeginning&&leftSum<=index||!startBeginning&&leftSum>index){if(currentNode.children[i].e!==null){leftSum=useFunction(leftSum,1)}leftSum=useFunction(leftSum,currentNode.children[i].subCounter);i=useFunction(i,1)}i=useFunction(i,-1);if(startBeginning){if(currentNode.children[i].e!==null){leftSum=useFunction(leftSum,-1)}leftSum=useFunction(leftSum,-currentNode.children[i].subCounter)}p=[];p.push(currentNode.children[i].t);if(buildingNode===null){buildingNode=new LSEQNode(p,null);queue=buildingNode}else{temp=new LSEQNode(p,null);queue.add(temp);queue=temp}return _get(leftSum,buildingNode,queue,currentNode.children[i])}return _get(0,null,null,this)};LSEQNode.prototype.fromJSON=function(object){this.t=new Triple(object.t.p,object.t.s,object.t.c);if(object.children.length===0){this.e=object.e;this.subCounter=0;this.children=[]}else{this.e=null;this.subCounter=1;this.children=[];this.children.push(new LSEQNode([],null).fromJSON(object.children[0]))}return this};module.exports=LSEQNode},{"./triple.js":13,"./util.js":14}],11:[function(require,module,exports){var BI=require("BigInt");var Base=require("./base.js")(15);var S=require("./strategy.js")(10);var ID=require("./identifier.js");var Triple=require("./triple.js");var LSEQNode=require("./lseqnode.js");function LSEQTree(s){var listTriple;this._s=s;this._c=0;this._hash=function(depth){return depth%2};this.length=0;this.root=new LSEQNode([],null);listTriple=[];listTriple.push(new Triple(0,0,0));this.root.add(new LSEQNode(listTriple,""));listTriple=[];listTriple.push(new Triple(Math.pow(2,Base.getBitBase(0))-1,Number.MAX_VALUE,Number.MAX_VALUE));this.root.add(new LSEQNode(listTriple,""))}LSEQTree.prototype.get=function(index){return this.root.get(index)};LSEQTree.prototype.insert=function(element,index){var pei=this.get(index),qei=this.get(index+1),id,couple;this._c+=1;id=this.alloc(pei,qei);couple={_e:element,_i:id};this.applyInsert(element,id,true);return couple};LSEQTree.prototype.remove=function(index){var ei=this.get(index+1),i=new ID(null,[],[]);i.fromNode(ei);this.applyRemove(ei);return i};LSEQTree.prototype.alloc=function(p,q){var interval=0,level=0;while(interval<=0){interval=Base.getInterval(p,q,level);++level}level-=1;if(this._hash(level)===0){return S.bPlus(p,q,level,interval,this._s,this._c)}else{return S.bMinus(p,q,level,interval,this._s,this._c)}};LSEQTree.prototype.applyInsert=function(e,i,noIndex){var node,result;if(i&&i._d&&i._s&&i._c){node=new ID(i._d,i._s,i._c).toNode(e)}if(i&&i.t&&i.children){node=new LSEQNode([],null).fromJSON(i)}result=this.root.add(node);if(result!==-1){this.length+=1}return result||!noIndex&&this.root.indexOf(node)};LSEQTree.prototype.applyRemove=function(i){var node,position;if(i&&i._d&&i._s&&i._c){node=new ID(i._d,i._s,i._c).toNode(null)}if(i&&i.t&&i.children){node=new LSEQNode([],null).fromJSON(i)}position=this.root.indexOf(node);if(position!==-1){this.root.del(node);this.length-=1}return position};LSEQTree.prototype.fromJSON=function(object){this._s=object._s;this._c=object._c;this.length=object.length;var self=this;function depthFirst(currentNode,currentPath){var triple=new Triple(currentNode.t.p,currentNode.t.s,currentNode.t.c);currentPath.push(triple);if(currentNode.e!==null){var copy=currentPath.slice();self.root.add(new LSEQNode(copy,currentNode.e))}for(var i=0;i<currentNode.children.length;++i){depthFirst(currentNode.children[i],currentPath)}currentPath.pop()}for(var i=0;i<object.root.children.length;++i){depthFirst(object.root.children[i],[])}return this};module.exports=LSEQTree},{"./base.js":8,"./identifier.js":9,"./lseqnode.js":10,"./strategy.js":12,"./triple.js":13,BigInt:15}],12:[function(require,module,exports){var BI=require("BigInt");var Base=require("./base.js")();var ID=require("./identifier.js");function Strategy(boundary){var DEFAULT_BOUNDARY=10;this._boundary=boundary||DEFAULT_BOUNDARY}Strategy.prototype.bPlus=function(p,q,level,interval,s,c){var copyP=p,copyQ=q,step=Math.min(this._boundary,interval),digit=BI.int2bigInt(0,Base.getSumBit(level)),value;for(var i=0;i<=level;++i){value=0;if(p!==null){value=p.t.p}BI.addInt_(digit,value);if(i!==level){BI.leftShift_(digit,Base.getBitBase(i+1))}if(p!==null&&p.children.length!==0){p=p.children[0]}else{p=null}}BI.addInt_(digit,Math.floor(Math.random()*step+1));return getSC(digit,copyP,copyQ,level,s,c)};Strategy.prototype.bMinus=function(p,q,level,interval,s,c){var copyP=p,copyQ=q,step=Math.min(this._boundary,interval),digit=BI.int2bigInt(0,Base.getSumBit(level)),pIsGreater=false,commonRoot=true,prevValue,nextValue;for(var i=0;i<=level;++i){prevValue=0;if(p!==null){prevValue=p.t.p}nextValue=0;if(q!==null){nextValue=q.t.p}if(commonRoot&&prevValue!==nextValue){commonRoot=false;pIsGreater=prevValue>nextValue}if(pIsGreater){nextValue=Math.pow(2,Base.getBitBase(i))-1}BI.addInt_(digit,nextValue);if(i!==level){BI.leftShift_(digit,Base.getBitBase(i+1))}if(q!==null&&q.children.length!==0){q=q.children[0]}else{q=null}if(p!==null&&p.children.length!==0){p=p.children[0]}else{p=null}}if(pIsGreater){BI.addInt_(digit,-Math.floor(Math.random()*step))}else{BI.addInt_(digit,-Math.floor(Math.random()*step)-1)}return getSC(digit,copyP,copyQ,level,s,c)};function getSC(d,p,q,level,s,c){var sources=[],counters=[],i=0,sumBit=Base.getSumBit(level),tempDigit,value;while(i<=level){tempDigit=BI.dup(d);BI.rightShift_(tempDigit,sumBit-Base.getSumBit(i));value=BI.modInt(tempDigit,Math.pow(2,Base.getBitBase(i)));sources[i]=s;counters[i]=c;if(q!==null&&q.t.p===value){sources[i]=q.t.s;counters[i]=q.t.c}if(p!==null&&p.t.p===value){sources[i]=p.t.s;counters[i]=p.t.c}if(q!==null&&q.children.length!==0){q=q.children[0]}else{q=null}if(p!==null&&p.children.length!==0){p=p.children[0]}else{p=null}++i}return new ID(d,sources,counters)}Strategy.instance=null;module.exports=function(args){if(args){Strategy.instance=new Strategy(args)}else{if(Strategy.instance===null){Strategy.instance=new Strategy}}return Strategy.instance}},{"./base.js":8,"./identifier.js":9,BigInt:15}],13:[function(require,module,exports){function Triple(path,site,counter){this.p=path;this.s=site;this.c=counter}Triple.prototype.compare=function(o){if(this.s===Number.MAX_VALUE&&this.c===Number.MAX_VALUE){return 1}if(o.s===Number.MAX_VALUE&&o.s===Number.MAX_VALUE){return-1}if(this.p<o.p){return-1}if(this.p>o.p){return 1}if(this.s<o.s){return-1}if(this.s>o.s){return 1}if(this.c<o.c){return-1}if(this.c>o.c){return 1}return 0};module.exports=Triple},{}],14:[function(require,module,exports){function binaryIndexOf(){Array.prototype.binaryIndexOf=function(searchElement){var minIndex=0;var maxIndex=this.length-1;var currentIndex;var currentElement;while(minIndex<=maxIndex){currentIndex=Math.floor((minIndex+maxIndex)/2);currentElement=this[currentIndex];if(currentElement.compare(searchElement)<0){minIndex=currentIndex+1}else if(currentElement.compare(searchElement)>0){maxIndex=currentIndex-1}else{return currentIndex}}return~maxIndex}}module.exports=binaryIndexOf()},{}],15:[function(require,module,exports){(function(){bpe=0;mask=0;radix=mask+1;digitsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-";for(bpe=0;1<<bpe+1>1<<bpe;bpe++);bpe>>=1;mask=(1<<bpe)-1;radix=mask+1;one=int2bigInt(1,1,1);t=new Array(0);ss=t;s0=t;s1=t;s2=t;s3=t;s4=t;s5=t;s6=t;s7=t;T=t;sa=t;mr_x1=t;mr_r=t;mr_a=t;eg_v=t;eg_u=t;eg_A=t;eg_B=t;eg_C=t;eg_D=t;md_q1=t;md_q2=t;md_q3=t;md_r=t;md_r1=t;md_r2=t;md_tt=t;primes=t;pows=t;s_i=t;s_i2=t;s_R=t;s_rm=t;s_q=t;s_n1=t;s_a=t;s_r2=t;s_n=t;s_b=t;s_d=t;s_x1=t;s_x2=t,s_aa=t;rpprb=t;function findPrimes(n){var i,s,p,ans;s=new Array(n);for(i=0;i<n;i++)s[i]=0;s[0]=2;p=0;for(;s[p]<n;){for(i=s[p]*s[p];i<n;i+=s[p])s[i]=1;p++;s[p]=s[p-1]+1;for(;s[p]<n&&s[s[p]];s[p]++);}ans=new Array(p);for(i=0;i<p;i++)ans[i]=s[i];return ans}function millerRabinInt(x,b){if(mr_x1.length!=x.length){mr_x1=dup(x);mr_r=dup(x);mr_a=dup(x)}copyInt_(mr_a,b);return millerRabin(x,mr_a)}function millerRabin(x,b){var i,j,k,s;if(mr_x1.length!=x.length){mr_x1=dup(x);mr_r=dup(x);mr_a=dup(x)}copy_(mr_a,b);copy_(mr_r,x);copy_(mr_x1,x);addInt_(mr_r,-1);addInt_(mr_x1,-1);k=0;for(i=0;i<mr_r.length;i++)for(j=1;j<mask;j<<=1)if(x[i]&j){s=k<mr_r.length+bpe?k:0;i=mr_r.length;j=mask}else k++;if(s)rightShift_(mr_r,s);powMod_(mr_a,mr_r,x);if(!equalsInt(mr_a,1)&&!equals(mr_a,mr_x1)){j=1;while(j<=s-1&&!equals(mr_a,mr_x1)){squareMod_(mr_a,x);if(equalsInt(mr_a,1)){return 0}j++}if(!equals(mr_a,mr_x1)){return 0}}return 1}function bitSize(x){var j,z,w;for(j=x.length-1;x[j]==0&&j>0;j--);for(z=0,w=x[j];w;w>>=1,z++);z+=bpe*j;return z}function expand(x,n){var ans=int2bigInt(0,(x.length>n?x.length:n)*bpe,0);copy_(ans,x);return ans}function randTruePrime(k){var ans=int2bigInt(0,k,0);randTruePrime_(ans,k);return trim(ans,1)}function randProbPrime(k){if(k>=600)return randProbPrimeRounds(k,2);if(k>=550)return randProbPrimeRounds(k,4);if(k>=500)return randProbPrimeRounds(k,5);if(k>=400)return randProbPrimeRounds(k,6);if(k>=350)return randProbPrimeRounds(k,7);if(k>=300)return randProbPrimeRounds(k,9);if(k>=250)return randProbPrimeRounds(k,12);if(k>=200)return randProbPrimeRounds(k,15);if(k>=150)return randProbPrimeRounds(k,18);if(k>=100)return randProbPrimeRounds(k,27);return randProbPrimeRounds(k,40)}function randProbPrimeRounds(k,n){var ans,i,divisible,B;B=3e4;ans=int2bigInt(0,k,0);if(primes.length==0)primes=findPrimes(3e4);if(rpprb.length!=ans.length)rpprb=dup(ans);for(;;){randBigInt_(ans,k,0);ans[0]|=1;divisible=0;for(i=0;i<primes.length&&primes[i]<=B;i++)if(modInt(ans,primes[i])==0&&!equalsInt(ans,primes[i])){divisible=1;break}for(i=0;i<n&&!divisible;i++){randBigInt_(rpprb,k,0);while(!greater(ans,rpprb))randBigInt_(rpprb,k,0);if(!millerRabin(ans,rpprb))divisible=1}if(!divisible)return ans}}function mod(x,n){var ans=dup(x);mod_(ans,n);return trim(ans,1)}function addInt(x,n){var ans=expand(x,x.length+1);addInt_(ans,n);return trim(ans,1)}function mult(x,y){var ans=expand(x,x.length+y.length);mult_(ans,y);return trim(ans,1)}function powMod(x,y,n){var ans=expand(x,n.length);powMod_(ans,trim(y,2),trim(n,2),0);return trim(ans,1)}function sub(x,y){var ans=expand(x,x.length>y.length?x.length+1:y.length+1);sub_(ans,y);return trim(ans,1)}function add(x,y){var ans=expand(x,x.length>y.length?x.length+1:y.length+1);add_(ans,y);return trim(ans,1)}function inverseMod(x,n){var ans=expand(x,n.length);var s;s=inverseMod_(ans,n);return s?trim(ans,1):null}function multMod(x,y,n){var ans=expand(x,n.length);multMod_(ans,y,n);return trim(ans,1)}function randTruePrime_(ans,k){var c,m,pm,dd,j,r,B,divisible,z,zz,recSize;if(primes.length==0)primes=findPrimes(3e4);if(pows.length==0){pows=new Array(512);for(j=0;j<512;j++){pows[j]=Math.pow(2,j/511-1)}}c=.1;m=20;recLimit=20;if(s_i2.length!=ans.length){s_i2=dup(ans);s_R=dup(ans);s_n1=dup(ans);s_r2=dup(ans);s_d=dup(ans);s_x1=dup(ans);s_x2=dup(ans);s_b=dup(ans);s_n=dup(ans);s_i=dup(ans);s_rm=dup(ans);s_q=dup(ans);s_a=dup(ans);s_aa=dup(ans)}if(k<=recLimit){pm=(1<<(k+2>>1))-1;copyInt_(ans,0);for(dd=1;dd;){dd=0;ans[0]=1|1<<k-1|Math.floor(Math.random()*(1<<k));for(j=1;j<primes.length&&(primes[j]&pm)==primes[j];j++){if(0==ans[0]%primes[j]){dd=1;break}}}carry_(ans);return}B=c*k*k;if(k>2*m)for(r=1;k-k*r<=m;)r=pows[Math.floor(Math.random()*512)];else r=.5;recSize=Math.floor(r*k)+1;randTruePrime_(s_q,recSize);copyInt_(s_i2,0);s_i2[Math.floor((k-2)/bpe)]|=1<<(k-2)%bpe;divide_(s_i2,s_q,s_i,s_rm);z=bitSize(s_i);for(;;){for(;;){randBigInt_(s_R,z,0);if(greater(s_i,s_R))break}addInt_(s_R,1);add_(s_R,s_i);copy_(s_n,s_q);mult_(s_n,s_R);multInt_(s_n,2);addInt_(s_n,1);copy_(s_r2,s_R);multInt_(s_r2,2);for(divisible=0,j=0;j<primes.length&&primes[j]<B;j++)if(modInt(s_n,primes[j])==0&&!equalsInt(s_n,primes[j])){divisible=1;break}if(!divisible)if(!millerRabinInt(s_n,2))divisible=1;if(!divisible){addInt_(s_n,-3);for(j=s_n.length-1;s_n[j]==0&&j>0;j--);for(zz=0,w=s_n[j];w;w>>=1,zz++);zz+=bpe*j;for(;;){randBigInt_(s_a,zz,0);if(greater(s_n,s_a))break}addInt_(s_n,3);addInt_(s_a,2);copy_(s_b,s_a);copy_(s_n1,s_n);addInt_(s_n1,-1);powMod_(s_b,s_n1,s_n);addInt_(s_b,-1);if(isZero(s_b)){copy_(s_b,s_a);powMod_(s_b,s_r2,s_n);addInt_(s_b,-1);copy_(s_aa,s_n);copy_(s_d,s_b);GCD_(s_d,s_n);if(equalsInt(s_d,1)){copy_(ans,s_aa);return}}}}}function randBigInt(n,s){var a,b;a=Math.floor((n-1)/bpe)+2;b=int2bigInt(0,0,a);randBigInt_(b,n,s);return b}function randBigInt_(b,n,s){var i,a;for(i=0;i<b.length;i++)b[i]=0;a=Math.floor((n-1)/bpe)+1;for(i=0;i<a;i++){b[i]=Math.floor(Math.random()*(1<<bpe-1))}b[a-1]&=(2<<(n-1)%bpe)-1;if(s==1)b[a-1]|=1<<(n-1)%bpe}function GCD(x,y){var xc,yc;xc=dup(x);yc=dup(y);GCD_(xc,yc);return xc}function GCD_(x,y){var i,xp,yp,A,B,C,D,q,sing;if(T.length!=x.length)T=dup(x);sing=1;while(sing){sing=0;for(i=1;i<y.length;i++)if(y[i]){sing=1;break}if(!sing)break;for(i=x.length;!x[i]&&i>=0;i--);xp=x[i];yp=y[i];A=1;B=0;C=0;D=1;while(yp+C&&yp+D){q=Math.floor((xp+A)/(yp+C));qp=Math.floor((xp+B)/(yp+D));if(q!=qp)break;t=A-q*C;A=C;C=t;t=B-q*D;B=D;D=t;t=xp-q*yp;xp=yp;yp=t}if(B){copy_(T,x);linComb_(x,y,A,B);linComb_(y,T,D,C)}else{mod_(x,y);copy_(T,x);copy_(x,y);copy_(y,T)}}if(y[0]==0)return;t=modInt(x,y[0]);copyInt_(x,y[0]);y[0]=t;while(y[0]){x[0]%=y[0];t=x[0];x[0]=y[0];y[0]=t}}function inverseMod_(x,n){var k=1+2*Math.max(x.length,n.length);if(!(x[0]&1)&&!(n[0]&1)){copyInt_(x,0);return 0}if(eg_u.length!=k){eg_u=new Array(k);eg_v=new Array(k);eg_A=new Array(k);eg_B=new Array(k);eg_C=new Array(k);eg_D=new Array(k)}copy_(eg_u,x);copy_(eg_v,n);copyInt_(eg_A,1);copyInt_(eg_B,0);copyInt_(eg_C,0);copyInt_(eg_D,1);for(;;){while(!(eg_u[0]&1)){halve_(eg_u);if(!(eg_A[0]&1)&&!(eg_B[0]&1)){halve_(eg_A);halve_(eg_B)}else{add_(eg_A,n);halve_(eg_A);sub_(eg_B,x);halve_(eg_B)}}while(!(eg_v[0]&1)){halve_(eg_v);if(!(eg_C[0]&1)&&!(eg_D[0]&1)){halve_(eg_C);halve_(eg_D)}else{add_(eg_C,n);halve_(eg_C);sub_(eg_D,x);halve_(eg_D)}}if(!greater(eg_v,eg_u)){sub_(eg_u,eg_v);sub_(eg_A,eg_C);sub_(eg_B,eg_D)}else{sub_(eg_v,eg_u);sub_(eg_C,eg_A);sub_(eg_D,eg_B)}if(equalsInt(eg_u,0)){if(negative(eg_C))add_(eg_C,n);copy_(x,eg_C);if(!equalsInt(eg_v,1)){copyInt_(x,0);return 0}return 1}}}function inverseModInt(x,n){var a=1,b=0,t;for(;;){if(x==1)return a;if(x==0)return 0;b-=a*Math.floor(n/x);n%=x;if(n==1)return b;if(n==0)return 0;a-=b*Math.floor(x/n);x%=n}}function inverseModInt_(x,n){return inverseModInt(x,n)}function eGCD_(x,y,v,a,b){var g=0;var k=Math.max(x.length,y.length);if(eg_u.length!=k){eg_u=new Array(k);eg_A=new Array(k);eg_B=new Array(k);eg_C=new Array(k);eg_D=new Array(k)}while(!(x[0]&1)&&!(y[0]&1)){halve_(x);halve_(y);g++}copy_(eg_u,x);copy_(v,y);copyInt_(eg_A,1);copyInt_(eg_B,0);copyInt_(eg_C,0);copyInt_(eg_D,1);for(;;){while(!(eg_u[0]&1)){halve_(eg_u);if(!(eg_A[0]&1)&&!(eg_B[0]&1)){halve_(eg_A);halve_(eg_B)}else{add_(eg_A,y);halve_(eg_A);sub_(eg_B,x);halve_(eg_B)}}while(!(v[0]&1)){halve_(v);if(!(eg_C[0]&1)&&!(eg_D[0]&1)){halve_(eg_C);halve_(eg_D)}else{add_(eg_C,y);halve_(eg_C);sub_(eg_D,x);halve_(eg_D)}}if(!greater(v,eg_u)){sub_(eg_u,v);sub_(eg_A,eg_C);sub_(eg_B,eg_D)}else{sub_(v,eg_u);sub_(eg_C,eg_A);sub_(eg_D,eg_B)}if(equalsInt(eg_u,0)){if(negative(eg_C)){add_(eg_C,y);sub_(eg_D,x)}multInt_(eg_D,-1);copy_(a,eg_C);copy_(b,eg_D);leftShift_(v,g);return}}}function negative(x){return x[x.length-1]>>bpe-1&1}function greaterShift(x,y,shift){var i,kx=x.length,ky=y.length;k=kx+shift<ky?kx+shift:ky;for(i=ky-1-shift;i<kx&&i>=0;i++)if(x[i]>0)return 1;for(i=kx-1+shift;i<ky;i++)if(y[i]>0)return 0;for(i=k-1;i>=shift;i--)if(x[i-shift]>y[i])return 1;else if(x[i-shift]<y[i])return 0;return 0}function greater(x,y){var i;var k=x.length<y.length?x.length:y.length;for(i=x.length;i<y.length;i++)if(y[i])return 0;for(i=y.length;i<x.length;i++)if(x[i])return 1;for(i=k-1;i>=0;i--)if(x[i]>y[i])return 1;else if(x[i]<y[i])return 0;return 0}function divide_(x,y,q,r){var kx,ky;var i,j,y1,y2,c,a,b;copy_(r,x);for(ky=y.length;y[ky-1]==0;ky--);b=y[ky-1];for(a=0;b;a++)b>>=1;a=bpe-a;leftShift_(y,a);leftShift_(r,a);for(kx=r.length;r[kx-1]==0&&kx>ky;kx--);copyInt_(q,0);while(!greaterShift(y,r,kx-ky)){subShift_(r,y,kx-ky);q[kx-ky]++}for(i=kx-1;i>=ky;i--){if(r[i]==y[ky-1])q[i-ky]=mask;else q[i-ky]=Math.floor((r[i]*radix+r[i-1])/y[ky-1]);for(;;){y2=(ky>1?y[ky-2]:0)*q[i-ky];c=y2>>bpe;y2=y2&mask;y1=c+q[i-ky]*y[ky-1];c=y1>>bpe;y1=y1&mask;if(c==r[i]?y1==r[i-1]?y2>(i>1?r[i-2]:0):y1>r[i-1]:c>r[i])q[i-ky]--;else break}linCombShift_(r,y,-q[i-ky],i-ky);if(negative(r)){addShift_(r,y,i-ky);q[i-ky]--}}rightShift_(y,a);rightShift_(r,a)}function carry_(x){var i,k,c,b;k=x.length;c=0;for(i=0;i<k;i++){c+=x[i];b=0;if(c<0){b=-(c>>bpe);c+=b*radix}x[i]=c&mask;c=(c>>bpe)-b}}function modInt(x,n){var i,c=0;for(i=x.length-1;i>=0;i--)c=(c*radix+x[i])%n;return c}function int2bigInt(t,bits,minSize){var i,k;k=Math.ceil(bits/bpe)+1;k=minSize>k?minSize:k;buff=new Array(k);copyInt_(buff,t);return buff}function str2bigInt(s,b,minSize){var d,i,j,base,str,x,y,kk;if(typeof b==="string"){base=b.length;str=b}else{base=b;str=digitsStr}var k=s.length;if(base==-1){x=new Array(0);for(;;){y=new Array(x.length+1);for(i=0;i<x.length;i++)y[i+1]=x[i];y[0]=parseInt(s,10);x=y;d=s.indexOf(",",0);if(d<1)break;s=s.substring(d+1);if(s.length==0)break}if(x.length<minSize){y=new Array(minSize);copy_(y,x);return y}return x}x=int2bigInt(0,base*k,0);for(i=0;i<k;i++){d=str.indexOf(s.substring(i,i+1),0);if(d>=base||d<0){continue}multInt_(x,base);addInt_(x,d)}for(k=x.length;k>0&&!x[k-1];k--);k=minSize>k+1?minSize:k+1;y=new Array(k);kk=k<x.length?k:x.length;for(i=0;i<kk;i++)y[i]=x[i];for(;i<k;i++)y[i]=0;return y}function equalsInt(x,y){var i;if(x[0]!=y)return 0;for(i=1;i<x.length;i++)if(x[i])return 0;return 1}function equals(x,y){var i;var k=x.length<y.length?x.length:y.length;for(i=0;i<k;i++)if(x[i]!=y[i])return 0;if(x.length>y.length){for(;i<x.length;i++)if(x[i])return 0}else{for(;i<y.length;i++)if(y[i])return 0}return 1}function isZero(x){var i;for(i=0;i<x.length;i++)if(x[i])return 0;return 1}function bigInt2str(x,b){var i,t,base,str,s="";if(typeof b==="string"){base=b.length;str=b}else{base=b;str=digitsStr}if(s6.length!=x.length)s6=dup(x);else copy_(s6,x);if(base==-1){for(i=x.length-1;i>0;i--)s+=x[i]+",";s+=x[0]}else{while(!isZero(s6)){t=divInt_(s6,base);s=str.substring(t,t+1)+s}}if(s.length==0)s=str[0];return s}function dup(x){var i;buff=new Array(x.length);copy_(buff,x);return buff}function copy_(x,y){var i;var k=x.length<y.length?x.length:y.length;for(i=0;i<k;i++)x[i]=y[i];for(i=k;i<x.length;i++)x[i]=0}function copyInt_(x,n){var i,c;for(c=n,i=0;i<x.length;i++){x[i]=c&mask;c>>=bpe}}function addInt_(x,n){var i,k,c,b;x[0]+=n;k=x.length;c=0;for(i=0;i<k;i++){c+=x[i];b=0;if(c<0){b=-(c>>bpe);c+=b*radix}x[i]=c&mask;c=(c>>bpe)-b;if(!c)return}}function rightShift_(x,n){var i;var k=Math.floor(n/bpe);if(k){for(i=0;i<x.length-k;i++)x[i]=x[i+k];for(;i<x.length;i++)x[i]=0;n%=bpe}for(i=0;i<x.length-1;i++){x[i]=mask&(x[i+1]<<bpe-n|x[i]>>n)}x[i]>>=n}function halve_(x){var i;for(i=0;i<x.length-1;i++){x[i]=mask&(x[i+1]<<bpe-1|x[i]>>1)}x[i]=x[i]>>1|x[i]&radix>>1}function leftShift_(x,n){var i;var k=Math.floor(n/bpe);if(k){for(i=x.length;i>=k;i--)x[i]=x[i-k];for(;i>=0;i--)x[i]=0;n%=bpe}if(!n)return;for(i=x.length-1;i>0;i--){x[i]=mask&(x[i]<<n|x[i-1]>>bpe-n)}x[i]=mask&x[i]<<n}function multInt_(x,n){var i,k,c,b;if(!n)return;k=x.length;c=0;for(i=0;i<k;i++){c+=x[i]*n;b=0;if(c<0){b=-(c>>bpe);c+=b*radix}x[i]=c&mask;c=(c>>bpe)-b}}function divInt_(x,n){var i,r=0,s;

for(i=x.length-1;i>=0;i--){s=r*radix+x[i];x[i]=Math.floor(s/n);r=s%n}return r}function linComb_(x,y,a,b){var i,c,k,kk;k=x.length<y.length?x.length:y.length;kk=x.length;for(c=0,i=0;i<k;i++){c+=a*x[i]+b*y[i];x[i]=c&mask;c>>=bpe}for(i=k;i<kk;i++){c+=a*x[i];x[i]=c&mask;c>>=bpe}}function linCombShift_(x,y,b,ys){var i,c,k,kk;k=x.length<ys+y.length?x.length:ys+y.length;kk=x.length;for(c=0,i=ys;i<k;i++){c+=x[i]+b*y[i-ys];x[i]=c&mask;c>>=bpe}for(i=k;c&&i<kk;i++){c+=x[i];x[i]=c&mask;c>>=bpe}}function addShift_(x,y,ys){var i,c,k,kk;k=x.length<ys+y.length?x.length:ys+y.length;kk=x.length;for(c=0,i=ys;i<k;i++){c+=x[i]+y[i-ys];x[i]=c&mask;c>>=bpe}for(i=k;c&&i<kk;i++){c+=x[i];x[i]=c&mask;c>>=bpe}}function subShift_(x,y,ys){var i,c,k,kk;k=x.length<ys+y.length?x.length:ys+y.length;kk=x.length;for(c=0,i=ys;i<k;i++){c+=x[i]-y[i-ys];x[i]=c&mask;c>>=bpe}for(i=k;c&&i<kk;i++){c+=x[i];x[i]=c&mask;c>>=bpe}}function sub_(x,y){var i,c,k,kk;k=x.length<y.length?x.length:y.length;for(c=0,i=0;i<k;i++){c+=x[i]-y[i];x[i]=c&mask;c>>=bpe}for(i=k;c&&i<x.length;i++){c+=x[i];x[i]=c&mask;c>>=bpe}}function add_(x,y){var i,c,k,kk;k=x.length<y.length?x.length:y.length;for(c=0,i=0;i<k;i++){c+=x[i]+y[i];x[i]=c&mask;c>>=bpe}for(i=k;c&&i<x.length;i++){c+=x[i];x[i]=c&mask;c>>=bpe}}function mult_(x,y){var i;if(ss.length!=2*x.length)ss=new Array(2*x.length);copyInt_(ss,0);for(i=0;i<y.length;i++)if(y[i])linCombShift_(ss,x,y[i],i);copy_(x,ss)}function mod_(x,n){if(s4.length!=x.length)s4=dup(x);else copy_(s4,x);if(s5.length!=x.length)s5=dup(x);divide_(s4,n,s5,x)}function multMod_(x,y,n){var i;if(s0.length!=2*x.length)s0=new Array(2*x.length);copyInt_(s0,0);for(i=0;i<y.length;i++)if(y[i])linCombShift_(s0,x,y[i],i);mod_(s0,n);copy_(x,s0)}function squareMod_(x,n){var i,j,d,c,kx,kn,k;for(kx=x.length;kx>0&&!x[kx-1];kx--);k=kx>n.length?2*kx:2*n.length;if(s0.length!=k)s0=new Array(k);copyInt_(s0,0);for(i=0;i<kx;i++){c=s0[2*i]+x[i]*x[i];s0[2*i]=c&mask;c>>=bpe;for(j=i+1;j<kx;j++){c=s0[i+j]+2*x[i]*x[j]+c;s0[i+j]=c&mask;c>>=bpe}s0[i+kx]=c}mod_(s0,n);copy_(x,s0)}function trim(x,k){var i,y;for(i=x.length;i>0&&!x[i-1];i--);y=new Array(i+k);copy_(y,x);return y}function powMod_(x,y,n){var k1,k2,kn,np;if(s7.length!=n.length)s7=dup(n);if((n[0]&1)==0){copy_(s7,x);copyInt_(x,1);while(!equalsInt(y,0)){if(y[0]&1)multMod_(x,s7,n);divInt_(y,2);squareMod_(s7,n)}return}copyInt_(s7,0);for(kn=n.length;kn>0&&!n[kn-1];kn--);np=radix-inverseModInt(modInt(n,radix),radix);s7[kn]=1;multMod_(x,s7,n);if(s3.length!=x.length)s3=dup(x);else copy_(s3,x);for(k1=y.length-1;k1>0&!y[k1];k1--);if(y[k1]==0){copyInt_(x,1);return}for(k2=1<<bpe-1;k2&&!(y[k1]&k2);k2>>=1);for(;;){if(!(k2>>=1)){k1--;if(k1<0){mont_(x,one,n,np);return}k2=1<<bpe-1}mont_(x,x,n,np);if(k2&y[k1])mont_(x,s3,n,np)}}function mont_(x,y,n,np){var i,j,c,ui,t,ks;var kn=n.length;var ky=y.length;if(sa.length!=kn)sa=new Array(kn);copyInt_(sa,0);for(;kn>0&&n[kn-1]==0;kn--);for(;ky>0&&y[ky-1]==0;ky--);ks=sa.length-1;for(i=0;i<kn;i++){t=sa[0]+x[i]*y[0];ui=(t&mask)*np&mask;c=t+ui*n[0]>>bpe;t=x[i];j=1;for(;j<ky-4;){c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++}for(;j<ky;){c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++}for(;j<kn-4;){c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++}for(;j<kn;){c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++}for(;j<ks;){c+=sa[j];sa[j-1]=c&mask;c>>=bpe;j++}sa[j-1]=c&mask}if(!greater(n,sa))sub_(sa,n);copy_(x,sa)}if(typeof module==="undefined"){module={}}BigInt=module.exports={add:add,addInt:addInt,bigInt2str:bigInt2str,bitSize:bitSize,dup:dup,equals:equals,equalsInt:equalsInt,expand:expand,findPrimes:findPrimes,GCD:GCD,greater:greater,greaterShift:greaterShift,int2bigInt:int2bigInt,inverseMod:inverseMod,inverseModInt:inverseModInt,isZero:isZero,millerRabin:millerRabin,millerRabinInt:millerRabinInt,mod:mod,modInt:modInt,mult:mult,multMod:multMod,negative:negative,powMod:powMod,randBigInt:randBigInt,randTruePrime:randTruePrime,randProbPrime:randProbPrime,str2bigInt:str2bigInt,sub:sub,trim:trim,addInt_:addInt_,add_:add_,copy_:copy_,copyInt_:copyInt_,GCD_:GCD_,inverseMod_:inverseMod_,mod_:mod_,mult_:mult_,multMod_:multMod_,powMod_:powMod_,randBigInt_:randBigInt_,randTruePrime_:randTruePrime_,sub_:sub_,addShift_:addShift_,carry_:carry_,divide_:divide_,divInt_:divInt_,eGCD_:eGCD_,halve_:halve_,leftShift_:leftShift_,linComb_:linComb_,linCombShift_:linCombShift_,mont_:mont_,multInt_:multInt_,rightShift_:rightShift_,squareMod_:squareMod_,subShift_:subShift_,powMod_:powMod_,eGCD_:eGCD_,inverseMod_:inverseMod_,GCD_:GCD_,mont_:mont_,divide_:divide_,squareMod_:squareMod_,randTruePrime_:randTruePrime_,millerRabin:millerRabin}})()},{}],16:[function(require,module,exports){arguments[4][1][0].apply(exports,arguments)},{dup:1}],17:[function(require,module,exports){var SortedArray=require("sorted-cmp-array");function InView(){this.sockets=new SortedArray(function(a,b){var first=a.id||a;var second=b.id||b;if(first<second){return-1}if(first>second){return 1}return 0})}InView.prototype.add=function(socket,id){this.sockets.insert({id:id,socket:socket})};InView.prototype.remove=function(id){var index=this.sockets.indexOf(id),socket=null;if(index>=0){socket=this.sockets.arr[index];this.sockets.arr.splice(index,1)}return socket};InView.prototype.length=function(){return this.sockets.arr.length};InView.prototype.clear=function(){for(var i=0;i<this.sockets.arr.length;++i){this.sockets.arr[i].socket.destroy()}this.sockets.arr.splice(0,this.sockets.arr.length)};module.exports=InView},{"sorted-cmp-array":32}],18:[function(require,module,exports){function MJoin(id){this.protocol="spray";this.type="MJoin";this.id=id}module.exports.MJoin=MJoin;function MRequestTicket(id){this.protocol="spray";this.type="MRequestTicket";this.id=id}module.exports.MRequestTicket=MRequestTicket;function MOfferTicket(id,ticket,peer){this.protocol="spray";this.type="MOfferTicket";this.id=id;this.ticket=ticket;this.peer=peer}module.exports.MOfferTicket=MOfferTicket;function MStampedTicket(id,ticket,peer){this.protocol="spray";this.type="MStampedTicket";this.id=id;this.ticket=ticket;this.peer=peer}module.exports.MStampedTicket=MStampedTicket;function MExchange(id,peer){this.protocol="spray";this.type="MExchange";this.id=id;this.peer=peer}module.exports.MExchange=MExchange},{}],19:[function(require,module,exports){var SortedArray=require("sorted-cmp-array");function comp(a,b){if(a.age<b.age){return-1}if(a.age>b.age){return 1}return 0}function PartialView(){this.array=new SortedArray(comp)}PartialView.prototype.getOldest=function(){return this.array.arr[0]};PartialView.prototype.incrementAge=function(){for(var i=0;i<this.array.arr.length;++i){this.array.arr[i].age+=1}};PartialView.prototype.getSample=function(neighbor,isInitiator){var sample=[];var clone=new SortedArray(comp);for(var i=0;i<this.array.arr.length;++i){clone.arr.push(this.array.arr[i])}var sampleSize=Math.ceil(this.array.arr.length/2);if(isInitiator){var index=clone.indexOf(neighbor);sample.push(clone.arr[index]);clone.arr.splice(index,1)}while(sample.length<sampleSize){var rn=Math.floor(Math.random()*clone.arr.length);sample.push(clone.arr[rn]);clone.arr.splice(rn,1)}return sample};PartialView.prototype.replace=function(sample,old,fresh){var result=[];for(var i=0;i<sample.length;++i){if(sample[i].id===old.id){result.push(fresh)}else{result.push(sample[i])}}return result};PartialView.prototype.addNeighbor=function(peer){peer.age=0;this.array.arr.push(peer)};PartialView.prototype.getIndex=function(peer){var i=0,index=-1;found=false;while(!found&&i<this.array.arr.length){if(peer.id===this.array.arr[i].id){found=true;index=i}++i}return index};PartialView.prototype.removePeer=function(peer){var index=this.getIndex(peer),removedEntry=null;if(index>-1){removedEntry=this.array.arr[index];this.array.arr.splice(index,1)}return removedEntry};PartialView.prototype.removePeerAge=function(peer,age){var found=false,i=0,removedEntry=null;while(!found&&i<this.array.arr.length){if(peer.id===this.array.arr[i].id&&age===this.array.arr[i].age){found=true;removedEntry=this.array.arr[i];this.array.arr.splice(i,1)}++i}return removedEntry};PartialView.prototype.removeAll=function(peer){var occ=0,i=0;while(i<this.array.arr.length){if(this.array.arr[i].id===peer.id){this.array.arr.splice(i,1);occ+=1}else{++i}}return occ};PartialView.prototype.removeSample=function(sample){for(var i=0;i<sample.length;++i){this.removePeerAge(sample[i],sample[i].age)}};PartialView.prototype.length=function(){return this.array.arr.length};PartialView.prototype.contains=function(peer){return this.getIndex(peer)>=0};PartialView.prototype.clear=function(){this.array.arr.splice(0,this.array.arr.length)};module.exports=PartialView},{"sorted-cmp-array":32}],20:[function(require,module,exports){var SortedArray=require("sorted-cmp-array");function Sockets(){this.array=new SortedArray(function(a,b){if(a.id<b.id){return-1}if(a.id>b.id){return 1}return 0});this.lastChance=null}Sockets.prototype.addSocket=function(socket,object){var contains=this.contains(object);if(!contains){this.array.insert({id:object.id,socket:socket})}return!contains};Sockets.prototype.removeSocket=function(object){var socket=this.getSocket(object);if(socket!==null){this.array.remove(object);this.lastChance=socket}return socket};Sockets.prototype.getSocket=function(object){var index=this.array.indexOf(object),socket=null;if(index!==-1){socket=this.array.arr[index].socket}return socket};Sockets.prototype.contains=function(object){return this.array.indexOf(object)!==-1};Sockets.prototype.length=function(){return this.array.arr.length};Sockets.prototype.clear=function(){for(var i=0;i<this.array.arr.length;++i){this.array.arr[i].socket.destroy()}this.array.arr.splice(0,this.array.arr.length)};module.exports=Sockets},{"sorted-cmp-array":32}],21:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var Socket=require("simple-peer");var util=require("util");var PartialView=require("./partialview.js");var InView=require("./inview.js");var Sockets=require("./sockets.js");var GUID=require("./guid.js");var Messages=require("./messages.js");var MJoin=Messages.MJoin;var MRequestTicket=Messages.MRequestTicket;var MOfferTicket=Messages.MOfferTicket;var MStampedTicket=Messages.MStampedTicket;var MExchange=Messages.MExchange;util.inherits(Spray,EventEmitter);function Spray(id,options){EventEmitter.call(this);this.DELTATIME=options&&options.deltatime||1e3*60*2;this.TIMEOUT=options&&options.timeout||1e3*60*1;this.ID=id&&""+id+""||GUID();this.OPTIONS=options||{};this.partialView=new PartialView;this.inView=new InView;this.sockets=new Sockets;this.pending=new Sockets;this.forwards=new Sockets;this.state="disconnect";var self=this;setInterval(function(){if(self.partialView.length()>0){self.exchange()}},this.DELTATIME);this.on("spray-receive",function(socket,message){self.onSprayReceive(socket,message)})}Spray.prototype.ready=function(callback){if(this.partialView.length()>0){callback()}};Spray.prototype.getPeers=function(k){var result=[];var cloneSockets=[];for(var i=0;i<this.sockets.length();++i){cloneSockets[i]=this.sockets.array.arr[i]}while(0<cloneSockets.length&&result.length<k){var rn=Math.floor(Math.random()*cloneSockets.length);result.push(cloneSockets[rn].socket);cloneSockets.splice(rn,1)}if(k>0&&result.length===0&&this.sockets.lastChance!==null){result.push(this.sockets.lastChance)}return result};Spray.prototype.updateState=function(){if(this.partialView.length()>0&&this.state!=="connect"){this.state="connect";this.emit("statechange","connect")}else if((this.partialView.length()===0&&this.inView.length()>0||this.partialView.length()>0&&this.inView.length()===0)&&this.state!=="partial"){this.state="partial";this.emit("statechange","partial")}else if(this.partialView.length()===0&&this.pending.length()===0&&this.state!=="disconnect"){this.state="disconnect";this.emit("statechange","disconnect")}};Spray.prototype.leave=function(){this.partialView.clear();this.inView.clear();this.sockets.clear();this.pending.clear();this.forwards.clear()};Spray.prototype.launch=function(callback){var options=this.OPTIONS;options.initiator=true;options.trickle=false;var socket=new Socket(options),id=GUID(),self=this;socket.on("signal",function(data){var message=new MOfferTicket(id,data,{id:self.ID});self.pending.addSocket(socket,message);callback(message)});setTimeout(function(){if(self.pending.contains({id:id})){self.pending.removeSocket({id:id});socket.destroy()}},this.TIMEOUT)};Spray.prototype.answer=function(message,callback){var options=this.OPTIONS;options.initiator=false;options.trickle=false;var socket=new Socket(options),id=message.id,ticket=message.ticket,peer=message.peer,self=this;socket.on("signal",function(data){var stampedTicket=new MStampedTicket(id,data,{id:self.ID});self.pending.addSocket(socket,stampedTicket);callback(stampedTicket)});socket.on("connect",function(){console.log("wrtc: successful connection establishment");self.pending.removeSocket(message);self.inView.add(socket,id);self.updateState()});socket.on("data",function(receivedMessage){self.receive(socket,receivedMessage)});socket.on("stream",function(stream){self.emit("stream",socket,stream)});socket.on("close",function(){console.log("wrtc: a connection has been closed");self.inView.remove(id);self.updateState()});socket.signal(ticket);setTimeout(function(){if(self.pending.contains({id:id})){var socket=self.pending.removeSocket({id:id});socket.destroy()}},this.TIMEOUT)};Spray.prototype.handshake=function(message){var socket=this.pending.removeSocket(message),id=message.id,ticket=message.ticket,peer=message.peer,self=this;socket.on("connect",function(){console.log("wrtc: successful connection establishment");self.partialView.addNeighbor(peer);self.sockets.addSocket(socket,peer);self.join(peer);self.updateState()});socket.on("data",function(receivedMessage){self.receive(socket,receivedMessage)});socket.on("stream",function(stream){self.emit("stream",socket,stream)});socket.on("close",function(){console.log("wrtc: a connection has been closed");self.updateState()});socket.signal(ticket)};Spray.prototype.join=function(contact){var message=new MJoin(GUID());this.send(message,contact)};Spray.prototype.onJoin=function(id){if(this.partialView.length()===0){var mRequestTicket=new MRequestTicket(GUID());this.send(mRequestTicket,{id:id})}else{for(var i=0;i<this.partialView.length();++i){var mRequestTicket=new MRequestTicket(GUID());this.forwards.addSocket(this.sockets.getSocket(this.partialView.array.arr[i]),mRequestTicket);this.send(mRequestTicket,{id:id})}}};Spray.prototype.exchange=function(){var self=this;var socketOldest=null;while(socketOldest===null||socketOldest!==null&&!socketOldest.connected&&this.partialView.length()>0){var oldest=this.partialView.getOldest();socketOldest=this.sockets.getSocket(oldest);if(socketOldest===null||socketOldest!==null&&!socketOldest.connected){this.onPeerDown(oldest)}}if(this.partialView.length()===0){return}var mExchange=new MExchange(GUID(),{id:this.ID});this.send(mExchange,oldest);var sample=this.partialView.getSample(oldest,true);for(var i=0;i<sample.length;++i){if(sample[i].id!==oldest.id){var message=new MRequestTicket(GUID());this.forwards.addSocket(this.sockets.getSocket(oldest),message);this.send(message,sample[i])}else{var idTicket=GUID();this.forwards.addSocket(this.sockets.getSocket(oldest),{id:idTicket});this.onTicketRequest(idTicket)}}this.partialView.removeSample(sample);for(var i=0;i<sample.length;++i){if(!this.partialView.contains(sample[i])){var socket=this.sockets.removeSocket(sample[i]);if(socket!==null){setTimeout(function(s){s.destroy()},this.TIMEOUT,socket)}}}};Spray.prototype.onExchange=function(id,initiator){var sample=this.partialView.getSample(initiator,false);for(var i=0;i<sample.length;++i){if(sample[i].id!==initiator.id){var message=new MRequestTicket(GUID());this.forwards.addSocket(this.forwards.getSocket({id:id}),message);this.send(message,sample[i])}else{var idTicket=GUID();this.forwards.addSocket(this.forwards.getSocket({id:id}),{id:idTicket});this.onTicketRequest(idTicket)}}this.partialView.removeSample(sample);for(var i=0;i<sample.length;++i){if(!this.partialView.contains(sample[i])){var socket=this.sockets.removeSocket(sample[i]);if(socket!==null){setTimeout(function(s){s.destroy()},this.TIMEOUT,socket)}}}};Spray.prototype.onPeerDown=function(peer){console.log("wrtc: a neighbor crashed/left");var occ=this.partialView.removeAll(peer);this.sockets.removeSocket(peer);if(this.partialView.length()>0){for(var i=0;i<occ;++i){if(Math.random()>1/(this.partialView.length()+occ)){var rn=Math.floor(Math.random()*this.partialView.length());this.partialView.addNeighbor(this.partialView.array.arr[rn]);console.log("wrtc: create a duplicate")}}}this.updateState()};Spray.prototype.onArcDown=function(){console.log("wrtc: an arc did not properly established");if(this.partialView.length()>0){var rn=Math.floor(Math.random()*this.partialView.length());this.partialView.addNeighbor(this.partialView.array.arr[rn])}this.updateState()};Spray.prototype.onTicketRequest=function(id){var options=this.OPTIONS;options.initiator=true;options.trickle=false;var socket=new Socket(options),self=this;socket.on("signal",function(data){var message=new MOfferTicket(id,data,{id:self.ID});self.pending.addSocket(socket,message);self.send(message,message);self.forwards.removeSocket(message)});socket.on("connect",function(){console.log("wrtc: successful connection establishment");self.pending.removeSocket({id:id});self.inView.add(socket,id);self.updateState()});socket.on("close",function(){console.log("wrtc: a connection has been closed");self.inView.remove(id);self.updateState()});socket.on("data",function(message){self.receive(socket,message)});socket.on("stream",function(stream){self.emit("stream",socket,stream)});setTimeout(function(){if(self.pending.contains({id:id})){self.pending.removeSocket({id:id});socket.destroy()}},this.TIMEOUT)};Spray.prototype.onStampedTicketRequest=function(id,ticket,peer){var self=this;if(this.partialView.contains(peer)){console.log("wrtc: create a duplicate");this.partialView.addNeighbor(peer);var message=new MStampedTicket(id,null,{id:self.ID});self.send(message,message);self.forwards.removeSocket({id:id});return}var options=this.OPTIONS;options.initiator=false;options.trickle=false;var socket=new Socket(options);socket.on("signal",function(data){var message=new MStampedTicket(id,data,{id:self.ID});self.send(message,message);self.forwards.removeSocket(message)});socket.on("connect",function(){console.log("wrtc: successful connection establishment");self.pending.removeSocket({id:id});self.partialView.addNeighbor(peer);if(!self.sockets.addSocket(socket,peer)){socket.destroy()}self.updateState()});socket.on("close",function(){console.log("wrtc: a connection has been closed");self.updateState()});socket.on("data",function(message){self.receive(socket,message)});socket.on("stream",function(stream){self.emit("stream",socket,stream)});socket.signal(ticket);this.pending.addSocket(socket,{id:id});setTimeout(function(){if(self.pending.contains({id:id})){self.pending.removeSocket({id:id});socket.destroy();self.onArcDown()}},this.TIMEOUT)};Spray.prototype.send=function(message,object){var sent=false;var id=object&&object.id||message.id;var socket=this.sockets.getSocket({id:id});if(socket!==null){if(socket.connected&&socket._channel&&socket._channel.readyState==="open"){socket.send(message);sent=true}else{this.onPeerDown({id:id})}}else{socket=this.forwards.getSocket({id:id});if(socket!==null&&socket.connected&&socket._channel&&socket._channel.readyState==="open"){socket.send(message);sent=true}}return sent};Spray.prototype.receive=function(socket,message){if(message&&message.protocol){this.emit(message.protocol+"-receive",socket,message)}};Spray.prototype.onSprayReceive=function(socket,message){switch(message.type){case"MJoin":console.log("wrtc: a new member joins the network");var self=this;setTimeout(function(){self.forwards.addSocket(socket,message);self.onJoin(message.id);self.forwards.removeSocket(message)},1e3);break;case"MRequestTicket":console.log("wrtc: a member request an offer ticket");this.forwards.addSocket(socket,message);this.onTicketRequest(message.id);break;case"MOfferTicket":console.log("wrtc: you received an offer ticket");if(!this.forwards.contains(message)){this.forwards.addSocket(socket,message);this.onStampedTicketRequest(message.id,message.ticket,message.peer)}else{if(this.send(message,message)){this.forwards.removeSocket(message);this.forwards.addSocket(socket,message)}else{this.forwards.removeSocket(message)}};break;case"MStampedTicket":console.log("wrtc: you received a stamped ticket");if(!this.forwards.contains(message)){if(message.ticket===null){var socket=this.pending.removeSocket(message);socket.destroy()}else{this.pending.getSocket(message).signal(message.ticket)}}else{this.send(message,message);this.forwards.removeSocket(message)};break;case"MExchange":console.log("wrtc: a peer starts to exchange with you");this.forwards.addSocket(socket,message);this.onExchange(message.id,message.peer);this.forwards.removeSocket(message);break}};module.exports=Spray},{"./guid.js":16,"./inview.js":17,"./messages.js":18,"./partialview.js":19,"./sockets.js":20,events:43,"simple-peer":22,util:64}],22:[function(require,module,exports){(function(Buffer){module.exports=Peer;var debug=require("debug")("simple-peer");var hat=require("hat");var inherits=require("inherits");var isTypedArray=require("is-typedarray");var once=require("once");var stream=require("stream");var toBuffer=require("typedarray-to-buffer");inherits(Peer,stream.Duplex);function Peer(opts){var self=this;if(!(self instanceof Peer))return new Peer(opts);self._debug("new peer %o",opts);if(!opts)opts={};opts.allowHalfOpen=false;if(opts.highWaterMark==null)opts.highWaterMark=1024*1024;stream.Duplex.call(self,opts);self.initiator=opts.initiator||false;self.channelConfig=opts.channelConfig||Peer.channelConfig;self.channelName=opts.channelName||hat(160);if(!opts.initiator)self.channelName=null;self.config=opts.config||Peer.config;self.constraints=opts.constraints||Peer.constraints;self.reconnectTimer=opts.reconnectTimer||0;self.sdpTransform=opts.sdpTransform||function(sdp){return sdp};self.stream=opts.stream||false;self.trickle=opts.trickle!==undefined?opts.trickle:true;self.destroyed=false;self.connected=false;self.remoteAddress=undefined;self.remoteFamily=undefined;self.remotePort=undefined;self.localAddress=undefined;self.localPort=undefined;self._wrtc=opts.wrtc||getBrowserRTC();if(!self._wrtc){if(typeof window==="undefined"){throw new Error("No WebRTC support: Specify `opts.wrtc` option in this environment")}else{throw new Error("No WebRTC support: Not a supported browser")}}self._maxBufferedAmount=opts.highWaterMark;self._pcReady=false;self._channelReady=false;self._iceComplete=false;self._channel=null;self._chunk=null;self._cb=null;self._interval=null;self._reconnectTimeout=null;self._pc=new self._wrtc.RTCPeerConnection(self.config,self.constraints);self._pc.oniceconnectionstatechange=self._onIceConnectionStateChange.bind(self);self._pc.onsignalingstatechange=self._onSignalingStateChange.bind(self);self._pc.onicecandidate=self._onIceCandidate.bind(self);if(self.stream)self._pc.addStream(self.stream);self._pc.onaddstream=self._onAddStream.bind(self);if(self.initiator){self._setupData({channel:self._pc.createDataChannel(self.channelName,self.channelConfig)});self._pc.onnegotiationneeded=once(self._createOffer.bind(self));if(typeof window==="undefined"||!window.webkitRTCPeerConnection){self._pc.onnegotiationneeded()}}else{self._pc.ondatachannel=self._setupData.bind(self)}self.on("finish",function(){if(self.connected){setTimeout(function(){self._destroy()},100)}else{self.once("connect",function(){setTimeout(function(){self._destroy()},100)})}})}Peer.WEBRTC_SUPPORT=!!getBrowserRTC();Peer.config={iceServers:[{url:"stun:23.21.150.121",urls:"stun:23.21.150.121"}]};Peer.constraints={};Peer.channelConfig={};Object.defineProperty(Peer.prototype,"bufferSize",{get:function(){var self=this;return self._channel&&self._channel.bufferedAmount||0}});Peer.prototype.address=function(){var self=this;return{port:self.localPort,family:"IPv4",address:self.localAddress}};Peer.prototype.signal=function(data){var self=this;if(self.destroyed)throw new Error("cannot signal after peer is destroyed");if(typeof data==="string"){try{data=JSON.parse(data)}catch(err){data={}}}self._debug("signal()");if(data.sdp){self._pc.setRemoteDescription(new self._wrtc.RTCSessionDescription(data),function(){if(self.destroyed)return;if(self._pc.remoteDescription.type==="offer")self._createAnswer()},self._onError.bind(self))}if(data.candidate){try{self._pc.addIceCandidate(new self._wrtc.RTCIceCandidate(data.candidate),noop,self._onError.bind(self))}catch(err){self._destroy(new Error("error adding candidate: "+err.message))}}if(!data.sdp&&!data.candidate){self._destroy(new Error("signal() called with invalid signal data"))}};Peer.prototype.send=function(chunk){var self=this;if(!isTypedArray.strict(chunk)&&!(chunk instanceof ArrayBuffer)&&!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&(typeof Blob==="undefined"||!(chunk instanceof Blob))){chunk=JSON.stringify(chunk)}if(Buffer.isBuffer(chunk)&&!isTypedArray.strict(chunk)){chunk=new Uint8Array(chunk)}var len=chunk.length||chunk.byteLength||chunk.size;self._channel.send(chunk);self._debug("write: %d bytes",len)};Peer.prototype.destroy=function(onclose){var self=this;self._destroy(null,onclose)};Peer.prototype._destroy=function(err,onclose){var self=this;if(self.destroyed)return;if(onclose)self.once("close",onclose);self._debug("destroy (error: %s)",err&&err.message);self.readable=self.writable=false;if(!self._readableState.ended)self.push(null);if(!self._writableState.finished)self.end();self.destroyed=true;self.connected=false;self._pcReady=false;self._channelReady=false;self._chunk=null;self._cb=null;clearInterval(self._interval);clearTimeout(self._reconnectTimeout);if(self._pc){try{self._pc.close()}catch(err){}self._pc.oniceconnectionstatechange=null;self._pc.onsignalingstatechange=null;self._pc.onicecandidate=null}if(self._channel){try{self._channel.close()}catch(err){}self._channel.onmessage=null;self._channel.onopen=null;self._channel.onclose=null}self._pc=null;self._channel=null;if(err)self.emit("error",err);self.emit("close")};Peer.prototype._setupData=function(event){var self=this;self._channel=event.channel;self.channelName=self._channel.label;self._channel.binaryType="arraybuffer";self._channel.onmessage=self._onChannelMessage.bind(self);self._channel.onopen=self._onChannelOpen.bind(self);self._channel.onclose=self._onChannelClose.bind(self)};Peer.prototype._read=function(){};Peer.prototype._write=function(chunk,encoding,cb){var self=this;if(self.destroyed)return cb(new Error("cannot write after peer is destroyed"));if(self.connected){self.send(chunk);if(self._channel.bufferedAmount>self._maxBufferedAmount){self._debug("start backpressure: bufferedAmount %d",self._channel.bufferedAmount);self._cb=cb}else{cb(null)}}else{self._debug("write before connect");self._chunk=chunk;self._cb=cb}};Peer.prototype._createOffer=function(){var self=this;if(self.destroyed)return;self._pc.createOffer(function(offer){if(self.destroyed)return;speedHack(offer);offer.sdp=self.sdpTransform(offer.sdp);self._pc.setLocalDescription(offer,noop,self._onError.bind(self));var sendOffer=function(){self._debug("signal");self.emit("signal",self._pc.localDescription||offer)};if(self.trickle||self._iceComplete)sendOffer();else self.once("_iceComplete",sendOffer)},self._onError.bind(self),self.offerConstraints)};Peer.prototype._createAnswer=function(){var self=this;if(self.destroyed)return;self._pc.createAnswer(function(answer){if(self.destroyed)return;speedHack(answer);answer.sdp=self.sdpTransform(answer.sdp);self._pc.setLocalDescription(answer,noop,self._onError.bind(self));var sendAnswer=function(){self._debug("signal");self.emit("signal",self._pc.localDescription||answer)};if(self.trickle||self._iceComplete)sendAnswer();else self.once("_iceComplete",sendAnswer)},self._onError.bind(self),self.answerConstraints)};Peer.prototype._onIceConnectionStateChange=function(){var self=this;if(self.destroyed)return;var iceGatheringState=self._pc.iceGatheringState;var iceConnectionState=self._pc.iceConnectionState;self._debug("iceConnectionStateChange %s %s",iceGatheringState,iceConnectionState);self.emit("iceConnectionStateChange",iceGatheringState,iceConnectionState);if(iceConnectionState==="connected"||iceConnectionState==="completed"){clearTimeout(self._reconnectTimeout);self._pcReady=true;self._maybeReady()}if(iceConnectionState==="disconnected"){if(self.reconnectTimer){clearTimeout(self._reconnectTimeout);self._reconnectTimeout=setTimeout(function(){self._destroy()},self.reconnectTimer)}else{self._destroy()}}if(iceConnectionState==="closed"){self._destroy()}};Peer.prototype._maybeReady=function(){var self=this;self._debug("maybeReady pc %s channel %s",self._pcReady,self._channelReady);if(self.connected||self._connecting||!self._pcReady||!self._channelReady)return;self._connecting=true;if(typeof window!=="undefined"&&!!window.mozRTCPeerConnection){self._pc.getStats(null,function(res){var items=[];res.forEach(function(item){items.push(item)});onStats(items)},self._onError.bind(self))}else{self._pc.getStats(function(res){var items=[];res.result().forEach(function(result){var item={};result.names().forEach(function(name){item[name]=result.stat(name)});item.id=result.id;item.type=result.type;item.timestamp=result.timestamp;items.push(item)});onStats(items)})}function onStats(items){items.forEach(function(item){if(item.type==="remotecandidate"){self.remoteAddress=item.ipAddress;self.remoteFamily="IPv4";self.remotePort=Number(item.portNumber);self._debug("connect remote: %s:%s (%s)",self.remoteAddress,self.remotePort,self.remoteFamily)}else if(item.type==="localcandidate"&&item.candidateType==="host"){self.localAddress=item.ipAddress;self.localPort=Number(item.portNumber);self._debug("connect local: %s:%s",self.localAddress,self.localPort)}});self._connecting=false;self.connected=true;if(self._chunk){self.send(self._chunk);self._chunk=null;self._debug('sent chunk from "write before connect"');var cb=self._cb;self._cb=null;cb(null)}self._interval=setInterval(function(){if(!self._cb||!self._channel||self._channel.bufferedAmount>self._maxBufferedAmount)return;self._debug("ending backpressure: bufferedAmount %d",self._channel.bufferedAmount);var cb=self._cb;self._cb=null;cb(null)},150);if(self._interval.unref)self._interval.unref();self._debug("connect");self.emit("connect")}};Peer.prototype._onSignalingStateChange=function(){var self=this;if(self.destroyed)return;self._debug("signalingStateChange %s",self._pc.signalingState);self.emit("signalingStateChange",self._pc.signalingState)};Peer.prototype._onIceCandidate=function(event){var self=this;if(self.destroyed)return;if(event.candidate&&self.trickle){self.emit("signal",{candidate:event.candidate})}else if(!event.candidate){self._iceComplete=true;self.emit("_iceComplete")}};Peer.prototype._onChannelMessage=function(event){var self=this;if(self.destroyed)return;var data=event.data;self._debug("read: %d bytes",data.byteLength||data.length);if(data instanceof ArrayBuffer){data=toBuffer(new Uint8Array(data));self.push(data)}else{try{data=JSON.parse(data)}catch(err){}self.emit("data",data)}};Peer.prototype._onChannelOpen=function(){var self=this;if(self.connected||self.destroyed)return;self._debug("on channel open");self._channelReady=true;self._maybeReady()};Peer.prototype._onChannelClose=function(){var self=this;

if(self.destroyed)return;self._debug("on channel close");self._destroy()};Peer.prototype._onAddStream=function(event){var self=this;if(self.destroyed)return;self._debug("on add stream");self.emit("stream",event.stream)};Peer.prototype._onError=function(err){var self=this;if(self.destroyed)return;self._debug("error %s",err.message||err);self._destroy(err)};Peer.prototype._debug=function(){var self=this;var args=[].slice.call(arguments);var id=self.channelName&&self.channelName.substring(0,7);args[0]="["+id+"] "+args[0];debug.apply(null,args)};function getBrowserRTC(){if(typeof window==="undefined")return null;var wrtc={RTCPeerConnection:window.mozRTCPeerConnection||window.RTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.mozRTCSessionDescription||window.RTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.mozRTCIceCandidate||window.RTCIceCandidate||window.webkitRTCIceCandidate};if(!wrtc.RTCPeerConnection)return null;return wrtc}function speedHack(obj){var s=obj.sdp.split("b=AS:30");if(s.length>1)obj.sdp=s[0]+"b=AS:1638400"+s[1]}function noop(){}}).call(this,{isBuffer:require("/usr/local/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js")})},{"/usr/local/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js":45,debug:23,hat:26,inherits:27,"is-typedarray":28,once:30,stream:61,"typedarray-to-buffer":31}],23:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{"./debug":24}],24:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:25}],25:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=""+str;if(str.length>1e4)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],26:[function(require,module,exports){var hat=module.exports=function(bits,base){if(!base)base=16;if(bits===undefined)bits=128;if(bits<=0)return"0";var digits=Math.log(Math.pow(2,bits))/Math.log(base);for(var i=2;digits===Infinity;i*=2){digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i}var rem=digits-Math.floor(digits);var res="";for(var i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}if(rem){var b=Math.pow(base,rem);var x=Math.floor(Math.random()*b).toString(base);res=x+res}var parsed=parseInt(res,base);if(parsed!==Infinity&&parsed>=Math.pow(2,bits)){return hat(bits,base)}else return res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(expandBy)bits+=expandBy;else throw new Error("too many ID collisions, use more bits")}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));hats[id]=data;return id};var hats=fn.hats={};fn.get=function(id){return fn.hats[id]};fn.set=function(id,value){fn.hats[id]=value;return fn};fn.bits=bits||128;fn.base=base||16;return fn}},{}],27:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],28:[function(require,module,exports){module.exports=isTypedArray;isTypedArray.strict=isStrictTypedArray;isTypedArray.loose=isLooseTypedArray;var toString=Object.prototype.toString;var names={"[object Int8Array]":true,"[object Int16Array]":true,"[object Int32Array]":true,"[object Uint8Array]":true,"[object Uint8ClampedArray]":true,"[object Uint16Array]":true,"[object Uint32Array]":true,"[object Float32Array]":true,"[object Float64Array]":true};function isTypedArray(arr){return isStrictTypedArray(arr)||isLooseTypedArray(arr)}function isStrictTypedArray(arr){return arr instanceof Int8Array||arr instanceof Int16Array||arr instanceof Int32Array||arr instanceof Uint8Array||arr instanceof Uint8ClampedArray||arr instanceof Uint16Array||arr instanceof Uint32Array||arr instanceof Float32Array||arr instanceof Float64Array}function isLooseTypedArray(arr){return names[toString.call(arr)]}},{}],29:[function(require,module,exports){module.exports=wrappy;function wrappy(fn,cb){if(fn&&cb)return wrappy(fn)(cb);if(typeof fn!=="function")throw new TypeError("need wrapper function");Object.keys(fn).forEach(function(k){wrapper[k]=fn[k]});return wrapper;function wrapper(){var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}var ret=fn.apply(this,args);var cb=args[args.length-1];if(typeof ret==="function"&&ret!==cb){Object.keys(cb).forEach(function(k){ret[k]=cb[k]})}return ret}}},{}],30:[function(require,module,exports){var wrappy=require("wrappy");module.exports=wrappy(once);once.proto=once(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return once(this)},configurable:true})});function once(fn){var f=function(){if(f.called)return f.value;f.called=true;return f.value=fn.apply(this,arguments)};f.called=false;return f}},{wrappy:29}],31:[function(require,module,exports){(function(Buffer){var isTypedArray=require("is-typedarray").strict;module.exports=function(arr){var constructor=Buffer.TYPED_ARRAY_SUPPORT?Buffer._augment:function(arr){return new Buffer(arr)};if(arr instanceof Uint8Array){return constructor(arr)}else if(arr instanceof ArrayBuffer){return constructor(new Uint8Array(arr))}else if(isTypedArray(arr)){return constructor(new Uint8Array(arr.buffer,arr.byteOffset,arr.byteLength))}else{return new Buffer(arr)}}}).call(this,require("buffer").Buffer)},{buffer:39,"is-typedarray":28}],32:[function(require,module,exports){"use strict";module.exports=SortedArray;var search=require("binary-search");function SortedArray(cmp,arr){if(typeof cmp!="function")throw new TypeError("comparator must be a function");this.arr=arr||[];this.cmp=cmp}SortedArray.prototype.insert=function(element){var index=search(this.arr,element,this.cmp);if(index<0)index=~index;this.arr.splice(index,0,element)};SortedArray.prototype.indexOf=function(element){var index=search(this.arr,element,this.cmp);return index>=0?index:-1};SortedArray.prototype.remove=function(element){var index=search(this.arr,element,this.cmp);if(index<0)return false;this.arr.splice(index,1);return true}},{"binary-search":33}],33:[function(require,module,exports){module.exports=function(haystack,needle,comparator,low,high){var mid,cmp;if(low===undefined)low=0;else{low=low|0;if(low<0||low>=haystack.length)throw new RangeError("invalid lower bound")}if(high===undefined)high=haystack.length-1;else{high=high|0;if(high<low||high>=haystack.length)throw new RangeError("invalid upper bound")}while(low<=high){mid=low+(high-low>>1);cmp=+comparator(haystack[mid],needle);if(cmp<0)low=mid+1;else if(cmp>0)high=mid-1;else return mid}return~low}},{}],34:[function(require,module,exports){var SortedArray=require("sorted-cmp-array");var Comparator=require("./vvweentry.js").Comparator;var VVwEEntry=require("./vvweentry.js");function VVwE(e){this.local=new VVwEEntry(e);this.vector=new SortedArray(Comparator);this.vector.insert(this.local)}VVwE.prototype.clone=function(){var cloneVVwE=new VVwE(this.local.e);for(var i=0;i<this.vector.arr.length;++i){cloneVVwE.vector.arr[i]=new VVwEEntry(this.vector.arr[i].e);cloneVVwE.vector.arr[i].v=this.vector.arr[i].v;for(var j=0;j<this.vector.arr[i].x.length;++j){cloneVVwE.vector.arr[i].x.push(this.vector.arr[i].x[j])}if(cloneVVwE.vector.arr[i].e===this.local.e){cloneVVwE.local=cloneVVwE.vector.arr[i]}}return cloneVVwE};VVwE.prototype.fromJSON=function(object){for(var i=0;i<object.vector.arr.length;++i){this.vector.arr[i]=new VVwEEntry(object.vector.arr[i].e);this.vector.arr[i].v=object.vector.arr[i].v;for(var j=0;j<object.vector.arr[i].x.length;++j){this.vector.arr[i].x.push(object.vector.arr[i].x[j])}if(object.vector.arr[i].e===object.local.e){this.local=this.vector.arr[i]}}return this};VVwE.prototype.increment=function(){this.local.increment();return{_e:this.local.e,_c:this.local.v}};VVwE.prototype.incrementFrom=function(ec){if(!ec||ec&&!ec._e||ec&&!ec._c){return}var index=this.vector.indexOf(ec._e);if(index<0){this.vector.insert(new VVwEEntry(ec._e));this.vector.arr[this.vector.indexOf(ec._e)].incrementFrom(ec._c)}else{this.vector.arr[index].incrementFrom(ec._c)}};VVwE.prototype.isReady=function(ec){var ready=!ec;if(!ready){var index=this.vector.indexOf(ec._e);ready=index>=0&&ec._c<=this.vector.arr[index].v&&this.vector.arr[index].x.indexOf(ec._c)<0}return ready};VVwE.prototype.isLower=function(ec){return ec&&this.isReady(ec)};VVwE.prototype.merge=function(other){for(var i=0;i<other.vector.arr.length;++i){var entry=other.vector.arr[i];var index=this.vector.indexOf(entry);if(index<0){var newEntry=new VVwEEntry(entry.e);newEntry.v=entry.v;for(var j=0;j<entry.x.length;++j){newEntry.x.push(entry.x[j])}this.vector.insert(newEntry)}else{var currEntry=this.vector.arr[i];var j=0;while(j<currEntry.x.length){if(currEntry.x[j]<entry.v&&entry.x.indexOf(currEntry.x[j])<0){currEntry.x.splice(j,1)}else{++j}}j=0;while(j<entry.x.length){if(entry.x[j]>currEntry.v&&currEntry.x.indexOf(entry.x[j])<0){currEntry.x.push(entry.x[j])}++j}currEntry.v=Math.max(currEntry.v,entry.v)}}};module.exports=VVwE},{"./vvweentry.js":35,"sorted-cmp-array":36}],35:[function(require,module,exports){function VVwEEntry(e){this.e=e;this.v=0;this.x=[]}VVwEEntry.prototype.increment=function(){this.v+=1};VVwEEntry.prototype.incrementFrom=function(c){if(c<this.v){var index=this.x.indexOf(c);if(index>=0){this.x.splice(index,1)}}if(c==this.v+1){this.v+=1}if(c>this.v+1){for(var i=this.v+1;i<c;++i){this.x.push(i)}this.v=c}};function Comparator(a,b){var aEntry=a.e||a;var bEntry=b.e||b;if(aEntry<bEntry){return-1}if(aEntry>bEntry){return 1}return 0}module.exports=VVwEEntry;module.exports.Comparator=Comparator},{}],36:[function(require,module,exports){arguments[4][32][0].apply(exports,arguments)},{"binary-search":37,dup:32}],37:[function(require,module,exports){arguments[4][33][0].apply(exports,arguments)},{dup:33}],38:[function(require,module,exports){},{}],39:[function(require,module,exports){(function(global){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();function typedArraySupport(){function Bar(){}try{var arr=new Uint8Array(1);arr.foo=function(){return 42};arr.constructor=Bar;return arr.foo()===42&&arr.constructor===Bar&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){if(!(this instanceof Buffer)){if(arguments.length>1)return new Buffer(arg,arguments[1]);return new Buffer(arg)}this.length=0;this.parent=undefined;if(typeof arg==="number"){return fromNumber(this,arg)}if(typeof arg==="string"){return fromString(this,arg,arguments.length>1?arguments[1]:"utf8")}return fromObject(this,arg)}function fromNumber(that,length){that=allocate(that,length<0?0:checked(length)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<length;i++){that[i]=0}}return that}function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding==="")encoding="utf8";var length=byteLength(string,encoding)|0;that=allocate(that,length);that.write(string,encoding);return that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(object==null){throw new TypeError("must start with number, buffer, array or string")}if(typeof ArrayBuffer!=="undefined"){if(object.buffer instanceof ArrayBuffer){return fromTypedArray(that,object)}if(object instanceof ArrayBuffer){return fromArrayBuffer(that,object)}}if(object.length)return fromArrayLike(that,object);return fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=checked(buffer.length)|0;that=allocate(that,length);buffer.copy(that,0,0,length);return that}function fromArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromTypedArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array){if(Buffer.TYPED_ARRAY_SUPPORT){array.byteLength;that=Buffer._augment(new Uint8Array(array))}else{that=fromTypedArray(that,new Uint8Array(array))}return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromJsonObject(that,object){var array;var length=0;if(object.type==="Buffer"&&isArray(object.data)){array=object.data;length=checked(array.length)|0}that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array}function allocate(that,length){if(Buffer.TYPED_ARRAY_SUPPORT){that=Buffer._augment(new Uint8Array(length));that.__proto__=Buffer.prototype}else{that.length=length;that._isBuffer=true}var fromPool=length!==0&&length<=Buffer.poolSize>>>1;if(fromPool)that.parent=rootParent;return that}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;var i=0;var len=Math.min(x,y);while(i<len){if(a[i]!==b[i])break;++i}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;i++){length+=list[i].length}}var buf=new Buffer(length);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function byteLength(string,encoding){if(typeof string!=="string")string=""+string;var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;function slowToString(encoding,start,end){var loweredCase=false;start=start|0;end=end===undefined||end===Infinity?this.length:end|0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return 0;return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.get=function get(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function set(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length|0;length=swap}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){
if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;i--){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;i++){target[i+targetStart]=this[i+start]}}else{target._set(this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function toArrayBuffer(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function _augment(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.indexOf=BP.indexOf;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=leadSurrogate-55296<<10|codePoint-56320|65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":40,ieee754:41,"is-array":42}],40:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],41:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],42:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],43:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],44:[function(require,module,exports){arguments[4][27][0].apply(exports,arguments)},{dup:27}],45:[function(require,module,exports){module.exports=function(obj){return!!(obj!=null&&(obj._isBuffer||obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)))}},{}],46:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],47:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],48:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":49}],49:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":51,"./_stream_writable":53,"core-util-is":54,inherits:44,"process-nextick-args":55}],50:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":52,"core-util-is":54,inherits:44}],51:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var util=require("core-util-is");util.inherits=require("inherits");var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else{return state.length}}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;

if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":49,_process:47,buffer:39,"core-util-is":54,events:43,inherits:44,isarray:46,"process-nextick-args":55,"string_decoder/":62,util:38}],52:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":49,"core-util-is":54,inherits:44}],53:[function(require,module,exports){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}WritableState.prototype.getBuffer=function writableStateGetBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:require("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use "+"_writableState.getBuffer() instead.")})}catch(_){}})();function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){processNextTick(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var buffer=[];var cbs=[];while(entry){cbs.push(entry.callback);buffer.push(entry);entry=entry.next}state.pendingcb++;state.lastBufferedRequest=null;doWrite(stream,state,true,state.length,buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}})}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true}},{"./_stream_duplex":49,buffer:39,"core-util-is":54,events:43,inherits:44,"process-nextick-args":55,"util-deprecate":56}],54:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("/usr/local/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js")})},{"/usr/local/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js":45}],55:[function(require,module,exports){(function(process){"use strict";module.exports=nextTick;function nextTick(fn){var args=new Array(arguments.length-1);var i=0;while(i<args.length){args[i++]=arguments[i]}process.nextTick(function afterTick(){fn.apply(null,args)})}}).call(this,require("_process"))},{_process:47}],56:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],57:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":50}],58:[function(require,module,exports){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":49,"./lib/_stream_passthrough.js":50,"./lib/_stream_readable.js":51,"./lib/_stream_transform.js":52,"./lib/_stream_writable.js":53}],59:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":52}],60:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":53}],61:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:43,inherits:44,"readable-stream/duplex.js":48,"readable-stream/passthrough.js":57,"readable-stream/readable.js":58,"readable-stream/transform.js":59,"readable-stream/writable.js":60}],62:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:39}],63:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],64:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){
var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":63,_process:47,inherits:44}],"crate-core":[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var util=require("util");var Spray=require("spray-wrtc");var CausalBroadcast=require("causal-broadcast-definition");var VVwE=require("version-vector-with-exceptions");var LSEQTree=require("lseqtree");var GUID=require("./guid.js");var MInsertOperation=require("./messages.js").MInsertOperation;var MAEInsertOperation=require("./messages.js").MAEInsertOperation;var MRemoveOperation=require("./messages.js").MRemoveOperation;var MCaretMovedOperation=require("./messages.js").MCaretMovedOperation;util.inherits(CrateCore,EventEmitter);function CrateCore(id,options){EventEmitter.call(this);this.id=id||GUID();this.options=options;this.broadcast=new CausalBroadcast(new Spray(this.id,this.options),new VVwE(this.id));this.sequence=new LSEQTree(this.id);var self=this;this.broadcast.on("receive",function(receivedBroadcastMessage){switch(receivedBroadcastMessage.type){case"MRemoveOperation":self.remoteRemove(receivedBroadcastMessage.remove);break;case"MInsertOperation":self.remoteInsert(receivedBroadcastMessage.insert);break;case"MCaretMovedOperation":self.remoteCaretMoved(receivedBroadcastMessage.caretMoved);break}});this.broadcast.on("antiEntropy",function(socket,remoteVVwE,localVVwE){var remoteVVwE=new VVwE(null).fromJSON(remoteVVwE);var toSearch=[];for(var i=0;i<localVVwE.vector.arr.length;++i){var localEntry=localVVwE.vector.arr[i];var index=remoteVVwE.vector.indexOf(localVVwE.vector.arr[i]);var start=1;if(index>=0){start=remoteVVwE.vector.arr[index].v+1}for(var j=start;j<=localEntry.v;++j){if(localEntry.x.indexOf(j)<0){toSearch.push({_e:localEntry.e,_c:j})}}if(index>=0){for(var j=0;j<remoteVVwE.vector.arr[index].x.length;++j){var except=remoteVVwE.vector.arr[index].x[j];if(localEntry.x.indexOf(except)<0&&except<=localEntry.v){toSearch.push({_e:localEntry.e,_c:except})}}}}var elements=self.getElements(toSearch);self.broadcast.sendAntiEntropyResponse(socket,localVVwE,elements)})}CrateCore.prototype.init=function(object){var local=this.broadcast.causality.local;this.broadcast.causality.fromJSON(object.causality);this.broadcast.causality.local=local;this.broadcast.causality.vector.insert(this.broadcast.causality.local);this.sequence.fromJSON(object.sequence);this.sequence._s=local.e;this.sequence._c=local.v};CrateCore.prototype.insert=function(character,index){var ei=this.sequence.insert(character,index);var id={_e:ei._i._s[ei._i._s.length-1],_c:ei._i._c[ei._i._c.length-1]};this.broadcast.send(new MInsertOperation(ei),id,null);return ei};CrateCore.prototype.remove=function(index){var i=this.sequence.remove(index);var isReady={_e:i._s[i._s.length-1],_c:i._c[i._c.length-1]};this.sequence._c+=1;var id={_e:this.sequence._s,_c:this.sequence._c};this.broadcast.send(new MRemoveOperation(i),id,isReady);return i};CrateCore.prototype.caretMoved=function(range){var isReady={_e:this.sequence._s,_c:this.sequence._c};this.sequence._c+=1;var id={_e:this.sequence._s,_c:this.sequence._c};var param={range:range,guid:this.sequence._s};this.broadcast.send(new MCaretMovedOperation(param),id,isReady);console.log("MCaretMovedOperation sent");return range};CrateCore.prototype.remoteInsert=function(ei){var index=this.sequence.applyInsert(ei._e,ei._i,false);this.emit("remoteInsert",ei._e,index);if(ei._i._s){this.emit("remoteCaretMoved",ei._i._s[0],{start:index,end:index})}else{this.emit("remoteCaretMoved",ei._i.t.s,{start:index,end:index})}};CrateCore.prototype.remoteRemove=function(id){var index=this.sequence.applyRemove(id);this.emit("remoteRemove",index);if(id._s){this.emit("remoteCaretMoved",id._s[0],{start:index-1,end:index-1})}else{this.emit("remoteCaretMoved",id.t.s,{start:index-1,end:index-1})}};CrateCore.prototype.remoteCaretMoved=function(param){this.emit("remoteCaretMoved",param.guid,param.range)};CrateCore.prototype.getElements=function(toSearch){var result=[],found,node,tempNode,i=this.sequence.length,j=0;while(toSearch.length>0&&i<=this.sequence.length&&i>0){node=this.sequence.get(i);tempNode=node;while(tempNode.children.length>0){tempNode=tempNode.children[0]}j=0;found=false;while(j<toSearch.length&&!found){if(tempNode.t.s===toSearch[j]._e&&tempNode.t.c===toSearch[j]._c){found=true;result.push(new MAEInsertOperation({_e:tempNode.e,_i:node},{_e:toSearch[j]._e,_c:toSearch[j]._c}));toSearch.splice(j,1)}else{++j}}--i}return result};module.exports=CrateCore},{"./guid.js":1,"./messages.js":2,"causal-broadcast-definition":3,events:43,lseqtree:11,"spray-wrtc":21,util:64,"version-vector-with-exceptions":34}]},{},[]);